---
title: "Project log"
author: "Pascal Visser"
date: "14-9-2021"
output: pdf_document
---

## Log demands 

- all steps of analysis
- log in English and easy to read
- data described in detail 
- no data processing steps missing
- clear order of analysis processing steps
- every step has a: intro, result, conclusion 

### voorbeeld goed figuur

```{r}
library(dplyr, ggplot2)
air <- dplyr::tibble(airquality)
ggplot(data = air, mapping = aes(x = Wind, y = Temp)) + geom_point(col = 'blue', alpha = 0.5) + 
  geom_smooth(method = 'loess', se = F) +
  xlab('Wind (mph)') + ylab('Temprature (F)') + theme_minimal()
```




















# Background 

In a research of breast cancer proteomes, 77 breast cancer samples are generated by the NCI/NIH (Clinical Proteomic Tumor Analysis Consortium) generating 3 datasets. A dataset with expression values, a dataset with genes and proteins used by the PAM50 classification system and a dataset with clinical annotations of the patients. 

The 77 breast cancer proteome expression values are log2 iTRAQ ratios for each sample. It contains ~12.000 proteins for each individual sample. This database also contains three samples from healthy individuals.

{MEER ACHTERGROND}

# Research question 

Is it possible to predict a breast cancer stage, based of the expression data from 77 cancer proteomes?

# Data

As named before, there are three datasets avalible. For this research, only two the the three will be used. The expression value data and the clinical patient data. There are 105 clinical patient samples and 77 proteome samples. 28 proteomes were cut of the final data due quality issues. 

The goal of this research is to see if it is possible to predict the tumor stage based on the protein expression levels of the patients. The clinical database contain useful annotations of the patients such as:

- ER status   (estrogen receptors)
- PR status   (progesterone receptors)
- HER2 status (HER2 aanwezigheid)
- Tumor stage (T1 t/m t4)
- Node stage  (N0 t/m N3)
- Metastasis  (M0 or M1)
- ACCJ status (stage ... )

All these factor can indicate the disice state of the patient. In this case, tumor stage is the most important factor. Because the prediction of this tumor stage will be based of the expression level of the samples. 

{UITLEG TUMOR STADIA}


# EDA

{EDA INTRO}

## Data formatting

### load data

The data will be loaded from the Data folder in the repository. 

```{r}
# load data
proteomes <- as.data.frame(read.csv(file = 'Data/cancer_proteomes.csv'))
patient_data <- as.data.frame(read.csv(file = "Data/data_patients.csv"))
head(proteomes)
```

The proteomes file contain 86 columns: 3 columns with gene information, 80 columns of expression data with TCGA.ID (with 3 duplicates) and 3 columns of expression data of healthy persons.   

Also the clinical patient data is loaded in. Containing the tumor stage annotation that will be used. 

### Transform data

To make the proteomes file more workable, the column name with the TCGA.ID will become the row name. Also the first 3 and the last 3 row will be excluded. The first 3 columns contains RefSeq number, gene_symbol and gene name. The RefSeq number will be saved as column name. The last 3 columns contains expression data of healthy people with no ID match to the patients, so this information is not needed. 

```{r}
# Transform colnames and rownames

# Save the RefSeq numbers
nm <- proteomes$RefSeq_accession_number

# Exclude col 1-3 and 84-86
proteomes <- as.data.frame(t(proteomes[,4:83]))
colnames(proteomes) <- nm

# Bind the colnames to the rows
proteomes <- cbind(rownames(proteomes), data.frame(proteomes, row.names=NULL))
colnames(proteomes)[1] <- "Complete.TCGA.ID"
```

To match the ID of the clinical patient data, the ID of the proteomes data will be transformed. Also the 3 duplicates will be removed.

```{r}
# Make function to transform TGCA ID
clinical.id <- function(proteome.id) {
  x = substr(proteome.id, 4, 7)
  y = substr(proteome.id, 0, 2)
  paste("TCGA",y,x,sep="-")
}

#Sapply to id column in proteomes
proteomes$Complete.TCGA.ID <- sapply(proteomes$Complete.TCGA.ID, clinical.id)
proteomes_new <- proteomes

# Remove duplicates
proteomes_new <- proteomes_new[!duplicated(proteomes_new$Complete.TCGA.ID), ]
head(proteomes_new)
```
Now the proteomes file has the ID in the first column. Then the next 12.554 columns are the expression data of the corresponding protein.

### tumor data

Next the tumor stage annotation must merge into the proteomes data frame.

```{r}
# Join data frames by ID
proteomes_complete <- merge(patient_data, proteomes_new, BY = 'Complete.TCGA.ID')

# Drop unwanted columns
proteomes_complete <- proteomes_complete[-c(2:6,8:30)]

# Rename column
colnames(proteomes_complete)[2] <- 'Tumor Stage'
head(proteomes_complete)
```

Now the Tumor stage annotation is added to the data frame. Now the data format is complete and ready for a EDA.

## Data Analysis

```{r}
x <- colSums(is.na(proteomes_complete)/nrow(proteomes_complete))
plot(sort(x, decreasing = T))
```


